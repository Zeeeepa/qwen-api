{
  "openapi": "3.1.0",
  "info": {
    "title": "Qwen API Proxy (OpenAI-compatible)",
    "version": "1.0.0",
    "description": "OpenAPI specification for the Qwen API Proxy. Endpoints are OpenAI-compatible and proxied to Qwen services."
  },
  "servers": [
    {
      "url": "https://qwen.tanu.me"
    },
    {
      "url": "https://{host}",
      "variables": {
        "host": {
          "default": "qwen.tanu.me"
        }
      }
    }
  ],
  "components": {
    "securitySchemes": {
      "BearerAuth": {
        "type": "http",
        "scheme": "bearer"
      }
    },
    "parameters": {
      "AuthHeader": {
        "name": "Authorization",
        "in": "header",
        "required": true,
        "description": "Bearer token generated by the README JS snippet (compressed).",
        "schema": {
          "type": "string",
          "default": "H4sIAAA..."
        },
        "example": "H4sIAAA..."
      }
    },
    "schemas": {
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "error": {
            "type": "object",
            "properties": {
              "message": {
                "type": "string"
              },
              "type": {
                "type": "string"
              },
              "param": {
                "type": ["string", "null"]
              },
              "code": {
                "oneOf": [
                  { "type": "string" },
                  { "type": "integer" }
                ]
              }
            },
            "required": [
              "message",
              "type",
              "code"
            ]
          }
        },
        "required": [
          "error"
        ]
      },
      "ModelObject": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "object": {
            "type": "string",
            "example": "model"
          },
          "owned_by": {
            "type": ["string", "null"]
          }
        },
        "required": [
          "id",
          "object"
        ]
      },
      "ModelList": {
        "type": "object",
        "properties": {
          "object": {
            "type": "string",
            "example": "list"
          },
          "data": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ModelObject"
            }
          }
        },
        "required": [
          "object",
          "data"
        ]
      },
      "ChatContentText": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "enum": [
              "text"
            ]
          },
          "text": {
            "type": "string"
          }
        },
        "required": [
          "type",
          "text"
        ]
      },
      "UrlRef": {
        "type": "object",
        "properties": {
          "url": {
            "type": "string"
          }
        },
        "required": [
          "url"
        ]
      },
      "ChatContentImageUrl": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "enum": [
              "image_url"
            ]
          },
          "image_url": {
            "$ref": "#/components/schemas/UrlRef"
          }
        },
        "required": [
          "type",
          "image_url"
        ]
      },
      "ChatContentAudioUrl": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "enum": [
              "audio_url"
            ]
          },
          "audio_url": {
            "$ref": "#/components/schemas/UrlRef"
          }
        },
        "required": [
          "type",
          "audio_url"
        ]
      },
      "ChatContentVideoUrl": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "enum": [
              "video_url"
            ]
          },
          "video_url": {
            "$ref": "#/components/schemas/UrlRef"
          }
        },
        "required": [
          "type",
          "video_url"
        ]
      },
      "ChatContentFileUrl": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "enum": [
              "file_url"
            ]
          },
          "file_url": {
            "$ref": "#/components/schemas/UrlRef"
          }
        },
        "required": [
          "type",
          "file_url"
        ]
      },
      "ChatContentPart": {
        "oneOf": [
          {
            "$ref": "#/components/schemas/ChatContentText"
          },
          {
            "$ref": "#/components/schemas/ChatContentImageUrl"
          },
          {
            "$ref": "#/components/schemas/ChatContentAudioUrl"
          },
          {
            "$ref": "#/components/schemas/ChatContentVideoUrl"
          },
          {
            "$ref": "#/components/schemas/ChatContentFileUrl"
          }
        ]
      },
      "ChatMessage": {
        "type": "object",
        "properties": {
          "role": {
            "type": "string",
            "enum": [
              "system",
              "user",
              "assistant",
              "tool"
            ]
          },
          "content": {
            "oneOf": [
              {
                "type": "string"
              },
              {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/ChatContentPart"
                }
              }
            ]
          }
        },
        "required": [
          "role",
          "content"
        ]
      },
      "ToolDefinition": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "enum": [
              "web_search",
              "code"
            ]
          }
        },
        "required": [
          "type"
        ]
      },
      "ChatRequest": {
        "type": "object",
        "properties": {
          "model": {
            "type": "string",
            "description": "Model ID (e.g., qwen-max-latest, qwen3-coder-plus, qwen-deep-research)"
          },
          "messages": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ChatMessage"
            }
          },
          "stream": {
            "type": "boolean",
            "default": false
          },
          "tools": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ToolDefinition"
            }
          },
          "enable_thinking": {
            "type": "boolean",
            "description": "Enable reasoning/thinking mode"
          },
          "thinking_budget": {
            "type": "integer",
            "description": "Thinking budget in ms"
          }
        },
        "required": [
          "model",
          "messages"
        ]
      },
      "ChatChoiceMessage": {
        "type": "object",
        "properties": {
          "role": {
            "type": "string"
          },
          "content": {
            "type": "string"
          },
          "reasoning_content": {
            "type": "string"
          }
        },
        "required": [
          "role",
          "content"
        ]
      },
      "ChatCompletionChoice": {
        "type": "object",
        "properties": {
          "index": {
            "type": "integer"
          },
          "message": {
            "$ref": "#/components/schemas/ChatChoiceMessage"
          },
          "finish_reason": {
            "type": ["string", "null"]
          }
        },
        "required": [
          "index",
          "message"
        ]
      },
      "ChatResponse": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "object": {
            "type": "string",
            "example": "chat.completion"
          },
          "created": {
            "type": "integer"
          },
          "model": {
            "type": "string"
          },
          "system_fingerprint": {
            "type": "string"
          },
          "choices": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ChatCompletionChoice"
            }
          }
        },
        "required": [
          "id",
          "object",
          "created",
          "model",
          "choices"
        ]
      },
      "ValidateRequest": {
        "type": "object",
        "properties": {
          "token": {
            "type": "string",
            "description": "Compressed token produced by the README JS snippet"
          }
        },
        "required": [
          "token"
        ]
      },
      "GenericUpstreamResponse": {
        "type": "object",
        "description": "Upstream response passthrough",
        "additionalProperties": true
      },
      "ImageGenerationRequest": {
        "type": "object",
        "properties": {
          "prompt": {
            "type": "string"
          },
          "size": {
            "type": "string",
            "example": "1024x1024",
            "description": "Target size; proxy maps to aspect ratio"
          }
        },
        "required": [
          "prompt"
        ]
      },
      "ImageOrVideoResponse": {
        "type": "object",
        "properties": {
          "created": {
            "type": "integer"
          },
          "data": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "url": {
                  "type": "string"
                }
              },
              "required": [
                "url"
              ]
            }
          }
        },
        "required": [
          "created",
          "data"
        ]
      },
      "ImageEditJsonRequest": {
        "type": "object",
        "properties": {
          "prompt": {
            "type": "string"
          },
          "image": {
            "oneOf": [
              {
                "type": "string",
                "format": "uri",
                "description": "Remote image URL"
              },
              {
                "type": "string",
                "description": "Data URL base64 image"
              }
            ]
          }
        },
        "required": [
          "prompt",
          "image"
        ]
      }
    }
  },
  "paths": {
    "/v1/models": {
      "get": {
        "summary": "List available models",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/AuthHeader"
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ModelList"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/v1/validate": {
      "post": {
        "summary": "Validate compressed token from JS snippet",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ValidateRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Validation result",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/GenericUpstreamResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "get": {
        "summary": "Validate compressed token via query string",
        "parameters": [
          {
            "in": "query",
            "name": "token",
            "schema": {
              "type": "string"
            },
            "required": true,
            "description": "Compressed token from JS snippet"
          }
        ],
        "responses": {
          "200": {
            "description": "Validation result",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/GenericUpstreamResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/v1/chat/completions": {
      "post": {
        "summary": "Create chat completion (OpenAI-compatible)",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/AuthHeader"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ChatRequest"
              },
              "examples": {
                "basic": {
                  "summary": "Basic chat completion",
                  "value": {
                    "model": "qwen-max-latest",
                    "messages": [
                      {
                        "role": "user",
                        "content": "Hello, how are you?"
                      }
                    ],
                    "stream": false
                  }
                },
                "web_search": {
                  "summary": "Chat with web search tool",
                  "value": {
                    "model": "qwen-max-latest",
                    "tools": [
                      {
                        "type": "web_search"
                      }
                    ],
                    "messages": [
                      {
                        "role": "user",
                        "content": "What are the latest AI developments?"
                      }
                    ],
                    "stream": false
                  }
                },
                "thinking": {
                  "summary": "Thinking mode",
                  "value": {
                    "model": "qwen-max-latest",
                    "enable_thinking": true,
                    "thinking_budget": 30000,
                    "messages": [
                      {
                        "role": "user",
                        "content": "Solve this complex math problem: ..."
                      }
                    ],
                    "stream": false
                  }
                },
                "coder": {
                  "summary": "Code generation (qwen3-coder-plus)",
                  "value": {
                    "model": "qwen3-coder-plus",
                    "tools": [
                      {
                        "type": "code"
                      }
                    ],
                    "messages": [
                      {
                        "role": "user",
                        "content": "Write a JavaScript function to add two numbers"
                      }
                    ],
                    "stream": false
                  }
                },
                "multimodal": {
                  "summary": "Vision-style multimodal",
                  "value": {
                    "model": "qwen-max-latest",
                    "messages": [
                      {
                        "role": "user",
                        "content": [
                          {
                            "type": "text",
                            "text": "What do you see in this image?"
                          },
                          {
                            "type": "image_url",
                            "image_url": {
                              "url": "https://download.samplelib.com/png/sample-hut-400x300.png"
                            }
                          }
                        ]
                      }
                    ],
                    "stream": false
                  }
                },
                "deep_research": {
                  "summary": "Deep research",
                  "value": {
                    "model": "qwen-deep-research",
                    "messages": [
                      {
                        "role": "user",
                        "content": "Research the latest developments in quantum computing"
                      }
                    ],
                    "stream": false
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ChatResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/v1/images/generations": {
      "post": {
        "summary": "Generate an image from a text prompt",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/AuthHeader"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ImageGenerationRequest"
              },
              "example": {
                "prompt": "A beautiful sunset over mountains",
                "size": "1024x1024"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ImageOrVideoResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/v1/images/edits": {
      "post": {
        "summary": "Edit an image using a prompt",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/AuthHeader"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "prompt": {
                    "type": "string"
                  },
                  "image": {
                    "type": "string",
                    "format": "binary"
                  }
                },
                "required": [
                  "prompt",
                  "image"
                ]
              }
            },
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ImageEditJsonRequest"
              },
              "example": {
                "prompt": "Add a rainbow in the background",
                "image": "https://example.com/image.jpg"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ImageOrVideoResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/v1/videos/generations": {
      "post": {
        "summary": "Generate a video from a text prompt",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/AuthHeader"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ImageGenerationRequest"
              },
              "example": {
                "prompt": "A cat playing with a ball of yarn in slow motion",
                "size": "1280x720"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ImageOrVideoResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    }
  }
}
